name: prosolo
author: David Laehnemann <david.laehnemann@hhu.de>, Johannes KÃ¶ster <johannes.koester@tu-dortmund.de>, Louis Dijkstra
about: "A caller for somatic variants in single cell-bulk sample pairs."

settings:
    - SubcommandRequired

global_settings:
    - ColoredHelp

args:
  - verbose:
      short: v
      help: Provide verbose output.

subcommands:
  - single-cell-bulk:
      about: Call somatic and germline variants from a single cell-bulk sample pair and a VCF/BCF with candidate variants.
      args:
        - single-cell:
            required: true
            help: BAM file with reads from single cell sample.
        - bulk:
            required: true
            help: BAM file with reads from bulk sample.
        - reference:
            required: true
            help: FASTA file with reference genome. Has to be indexed with samtools faidx.
        - candidates:
            long: candidates
            short: c
            value_name: FILE
            help: VCF/BCF file to process (if omitted, read from STDIN).
        - output:
            long: output
            short: o
            value_name: FILE
            help: BCF file that shall contain the results (if omitted, write to STDOUT).
        - single-cell-insert-size-mean:
            long: sc-isize-mean
            required: true
            short: m
            value_name: FLOAT
            help: Mean of single cell sample insert size.
        - single-cell-insert-size-sd:
            long: sc-isize-sd
            short: s
            required: true
            value_name: FLOAT
            help: Standard deviation of single cell sample insert size.
        - bulk-insert-size-mean:
            long: b-isize-mean
            value_name: FLOAT
            help: Mean of bulk sample insert size (if it differs from single cell).
        - bulk-insert-size-sd:
            long: b-isize-sd
            value_name: FLOAT
            help: Standard deviation of bulk sample insert size (if it differs from single cell).
#        - effective-mutation-rate:
#            long: effmut
#            value_name: FLOAT
#            help: Effective SNV mutation rate of bulk sample (should be estimated from somatic SNVs, ignored if --flat-priors).
#        - deletion-factor:
#            long: deletion-factor
#            short: d
#            value_name: FLOAT
#            help: Factor of deletion mutation rate relative to SNV mutation rate [0.03 according to Hodkinson et al. Nature Reviews Genetics 2011].
#        - insertion-factor:
#            long: insertion-factor
#            short: i
#            value_name: FLOAT
#            help: Factor of insertion mutation rate relative to SNV mutation rate [0.01 according to Hodkinson et al. Nature Reviews Genetics 2011].
        - ploidy:
            long: ploidy
            short: p
            value_name: INT
            help: General ploidy of sampled individual [2].
        - bulk-min-n:
            long: bulk-min-n
            value_name: INT
            help: Minimum number of (theoretical) reads to work with in the bulk background, in case the actual read count for a variant site is lower (in this case, probabilities will be computed for all discrete allele frequencies allowed by the minimum read count provided here). The code will work with a minimum of 2, but for a more even sampling of Event spaces, the default is at [8].
        - bulk-max-n:
            long: bulk-max-n
            value_name: INT
            help: Maximum number of (theoretical) reads to work with in the bulk background, in case the actual read count for a variant is higher (all read information will be used, but probabilities will only be computed for all discrete allele frequencies allowed by the maximum read count provided here). The code will work with any number above bulk-min-n, but we use the cap of the currently used Lodato amplification bias model for the single cell sample as the default [100].
#        - purity:
#            long: purity
#            short: a
#            value_name: FLOAT
#            help: Purity of tumor sample [1.0].
#        - heterozygosity:
#            long: het
#            value_name: FLOAT
#            help: Expected heterozygosity of bulk sample (ignored if --flat-priors) [1.25E-4].
        - adjust-mapq:
            long: adjust-mapq
            help: Downgrade mapping quality of alignments supporting an indel if there are no fragments supporting the same indel. Such cases are more likely to be alignment/repeat artifacts.
        - pileup-window:
            long: pileup-window
            value_name: INT
            help: Window to investigate for evidence left and right of each variant [2500].
        - omit-snvs:
            long: omit-snvs
            help: Don't call SNVs.
        - omit-indels:
            long: omit-indels
            help: Don't call indels.
        - omit-fragment-evidence:
            long: omit-fragment-evidence
            help: Omit evidence consisting of read pairs with unexpected insert size (insert size parameters will be ignored).
        - omit-secondary-alignments:
            long: omit-secondary-alignments
            help: Omit secondary alignments.
        - omit-mapq:
            long: omit-mapq
            help: Omit mapping quality (all alignments are trusted).
        - observations:
            long: obs
            value_name: FILE
            help: Optional path where read observations shall be written to. The resulting file contains a line for each observation with tab-separated values.
#        - flat-priors:
#            long: flat-priors
#            help: Ignore the prior model and use flat priors instead.
        - max-indel-len:
            long: max-indel-len
            value_name: INT
            help: Omit longer indels when calling [1000].
        - exclusive-end:
            long: exclusive-end
            help: Assume that the END tag is exclusive (i.e. it points to the position after the variant). This is needed, e.g., for DELLY.
        - max-indel-overlap:
            long: max-indel-overlap
            value_name: INT
            help: When considering read evidence for an indel, omit alignments that overlap more than the given value. The default value ensures fair sampling of reads supporting alternative and reference allele. Choosing a too large overlap results in biases towards the reference allele, because of too low MAPQs and unmapped reads [25].

  - estimate-mutation-rate:
      about: Estimate the effective mutation rate of a tumor sample from a VCF/BCF with candidate variants from STDIN.
      args:
        - min-af:
            long: min-af
            short: f
            value_name: FLOAT
            help: Minimum allele frequency to consider [0.12].
        - max-af:
            long: max-af
            short: F
            value_name: FLOAT
            help: Maximum allele frequency to consider [0.25].
        - fit:
            long: fit
            value_name: FILE
            help: Path to file that will contain observations and the parameters of the fitted model as JSON.

  - control-fdr:
      about: Print thresholds for controlling the FDR at different levels using Benjamini-Hochberg over p-values generated from an empirical null distribution of posterior error probabilities.
      args:
        - calls:
            required: true
            help: Calls as provided by prosic tumor-normal.
        - method:
            required: true
            long: method
            value_name: STRING
            possible_values:
              - bh
              - ev
            help: |
              Method to use. If bh, use Benjamini-Hochberg over p-values generated from an empirical null distribution of posterior error probabilities (--null-calls is required in this case).
              If ev, calculate the expected FDR over posterior error probabilities as presented by Mueller et al. 2006.
        - null-calls:
            value_name: FILE
            long: null-calls
            help: Null model calls as provided by prosolo single-cell-bulk, e.g. when flipping single cell and bulk sample.
        - events:
            required: true
            long: events
            short: e
            value_name: STRING(,STRING)*
            use_delimiter: true
            help: Comma-separated list of Events to consider jointly (e.g. `--events Event1,Event2`).
        - vartype:
            required: true
            long: var
            value_name: STRING
            help: Variant type to consider (SNV, INS, DEL).
        - min-len:
            long: min-len
            value_name: INT
            help: Minimum indel length to consider.
        - max-len:
            long: max-len
            value_name: INT
            help: Maximum indel length to consider (exclusive).
